
> backend@0.0.1 start
> nest start

[32m[Nest] 482379  - [39m02/08/2026, 5:57:55 PM [32m    LOG[39m [38;5;3m[NestFactory] [39m[32mStarting Nest application...[39m
[32m[Nest] 482379  - [39m02/08/2026, 5:57:55 PM [32m    LOG[39m [38;5;3m[InstanceLoader] [39m[32mPrismaModule dependencies initialized[39m[38;5;3m +18ms[39m
[32m[Nest] 482379  - [39m02/08/2026, 5:57:55 PM [32m    LOG[39m [38;5;3m[InstanceLoader] [39m[32mPassportModule dependencies initialized[39m[38;5;3m +1ms[39m
[32m[Nest] 482379  - [39m02/08/2026, 5:57:55 PM [32m    LOG[39m [38;5;3m[InstanceLoader] [39m[32mConfigHostModule dependencies initialized[39m[38;5;3m +0ms[39m
[32m[Nest] 482379  - [39m02/08/2026, 5:57:55 PM [32m    LOG[39m [38;5;3m[InstanceLoader] [39m[32mTenantsModule dependencies initialized[39m[38;5;3m +0ms[39m
[32m[Nest] 482379  - [39m02/08/2026, 5:57:55 PM [32m    LOG[39m [38;5;3m[InstanceLoader] [39m[32mAppModule dependencies initialized[39m[38;5;3m +3ms[39m
[32m[Nest] 482379  - [39m02/08/2026, 5:57:55 PM [32m    LOG[39m [38;5;3m[InstanceLoader] [39m[32mConfigModule dependencies initialized[39m[38;5;3m +0ms[39m
[32m[Nest] 482379  - [39m02/08/2026, 5:57:55 PM [32m    LOG[39m [38;5;3m[InstanceLoader] [39m[32mJwtModule dependencies initialized[39m[38;5;3m +1ms[39m
[32m[Nest] 482379  - [39m02/08/2026, 5:57:55 PM [32m    LOG[39m [38;5;3m[InstanceLoader] [39m[32mPatientsModule dependencies initialized[39m[38;5;3m +1ms[39m
[32m[Nest] 482379  - [39m02/08/2026, 5:57:55 PM [32m    LOG[39m [38;5;3m[InstanceLoader] [39m[32mVisitsModule dependencies initialized[39m[38;5;3m +0ms[39m
[32m[Nest] 482379  - [39m02/08/2026, 5:57:55 PM [32m    LOG[39m [38;5;3m[InstanceLoader] [39m[32mAuthModule dependencies initialized[39m[38;5;3m +0ms[39m
[32m[Nest] 482379  - [39m02/08/2026, 5:57:55 PM [32m    LOG[39m [38;5;3m[RoutesResolver] [39m[32mAppController {/}:[39m[38;5;3m +22ms[39m
[32m[Nest] 482379  - [39m02/08/2026, 5:57:55 PM [32m    LOG[39m [38;5;3m[RouterExplorer] [39m[32mMapped {/, GET} route[39m[38;5;3m +3ms[39m
[32m[Nest] 482379  - [39m02/08/2026, 5:57:55 PM [32m    LOG[39m [38;5;3m[RoutesResolver] [39m[32mTenantsController {/tenants}:[39m[38;5;3m +0ms[39m
[32m[Nest] 482379  - [39m02/08/2026, 5:57:55 PM [32m    LOG[39m [38;5;3m[RoutesResolver] [39m[32mAuthController {/auth}:[39m[38;5;3m +1ms[39m
[32m[Nest] 482379  - [39m02/08/2026, 5:57:55 PM [32m    LOG[39m [38;5;3m[RouterExplorer] [39m[32mMapped {/auth/register-tenant, POST} route[39m[38;5;3m +1ms[39m
[32m[Nest] 482379  - [39m02/08/2026, 5:57:55 PM [32m    LOG[39m [38;5;3m[RouterExplorer] [39m[32mMapped {/auth/login, POST} route[39m[38;5;3m +1ms[39m
[32m[Nest] 482379  - [39m02/08/2026, 5:57:55 PM [32m    LOG[39m [38;5;3m[RouterExplorer] [39m[32mMapped {/auth/profile, GET} route[39m[38;5;3m +1ms[39m
[32m[Nest] 482379  - [39m02/08/2026, 5:57:55 PM [32m    LOG[39m [38;5;3m[RoutesResolver] [39m[32mPatientsController {/patients}:[39m[38;5;3m +0ms[39m
[32m[Nest] 482379  - [39m02/08/2026, 5:57:55 PM [32m    LOG[39m [38;5;3m[RouterExplorer] [39m[32mMapped {/patients, POST} route[39m[38;5;3m +1ms[39m
[32m[Nest] 482379  - [39m02/08/2026, 5:57:55 PM [32m    LOG[39m [38;5;3m[RouterExplorer] [39m[32mMapped {/patients, GET} route[39m[38;5;3m +0ms[39m
[32m[Nest] 482379  - [39m02/08/2026, 5:57:55 PM [32m    LOG[39m [38;5;3m[RouterExplorer] [39m[32mMapped {/patients/:id, GET} route[39m[38;5;3m +1ms[39m
[32m[Nest] 482379  - [39m02/08/2026, 5:57:55 PM [32m    LOG[39m [38;5;3m[RouterExplorer] [39m[32mMapped {/patients/:id, PATCH} route[39m[38;5;3m +1ms[39m
[32m[Nest] 482379  - [39m02/08/2026, 5:57:55 PM [32m    LOG[39m [38;5;3m[RouterExplorer] [39m[32mMapped {/patients/:id, DELETE} route[39m[38;5;3m +1ms[39m
[32m[Nest] 482379  - [39m02/08/2026, 5:57:55 PM [32m    LOG[39m [38;5;3m[RoutesResolver] [39m[32mVisitsController {/visits}:[39m[38;5;3m +0ms[39m
[32m[Nest] 482379  - [39m02/08/2026, 5:57:55 PM [32m    LOG[39m [38;5;3m[RouterExplorer] [39m[32mMapped {/visits, POST} route[39m[38;5;3m +1ms[39m
[32m[Nest] 482379  - [39m02/08/2026, 5:57:55 PM [32m    LOG[39m [38;5;3m[RouterExplorer] [39m[32mMapped {/visits, GET} route[39m[38;5;3m +0ms[39m
[32m[Nest] 482379  - [39m02/08/2026, 5:57:55 PM [32m    LOG[39m [38;5;3m[RouterExplorer] [39m[32mMapped {/visits/:id, GET} route[39m[38;5;3m +0ms[39m
[32m[Nest] 482379  - [39m02/08/2026, 5:57:55 PM [32m    LOG[39m [38;5;3m[RouterExplorer] [39m[32mMapped {/visits/:id/triage, PATCH} route[39m[38;5;3m +1ms[39m
[32m[Nest] 482379  - [39m02/08/2026, 5:57:55 PM [32m    LOG[39m [38;5;3m[RouterExplorer] [39m[32mMapped {/visits/:id/consultation, PATCH} route[39m[38;5;3m +0ms[39m
[32m[Nest] 482379  - [39m02/08/2026, 5:57:56 PM [32m    LOG[39m [38;5;3m[NestApplication] [39m[32mNest application successfully started[39m[38;5;3m +108ms[39m
[31m[Nest] 482379  - [39m02/08/2026, 8:24:26 PM [31m  ERROR[39m [38;5;3m[ExceptionsHandler] [39mPrismaClientKnownRequestError: 
Invalid `this.prisma.visit.create()` invocation in
/home/calm/nestJs/MediFlow/backend/src/visits/visits.service.ts:22:34

  19     throw new NotFoundException('Patient not found in this tenant');
  20 }
  21 
â†’ 22 return this.prisma.visit.create(
Foreign key constraint violated on the constraint: `Visit_departmentId_fkey`
    at Vr.handleRequestError [90m(/home/calm/nestJs/MediFlow/backend/[39mnode_modules/[4m@prisma[24m/client/src/runtime/RequestHandler.ts:228:13[90m)[39m
    at Vr.handleAndLogRequestError [90m(/home/calm/nestJs/MediFlow/backend/[39mnode_modules/[4m@prisma[24m/client/src/runtime/RequestHandler.ts:174:12[90m)[39m
    at Vr.request [90m(/home/calm/nestJs/MediFlow/backend/[39mnode_modules/[4m@prisma[24m/client/src/runtime/RequestHandler.ts:143:12[90m)[39m
[90m    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)[39m
    at a [90m(/home/calm/nestJs/MediFlow/backend/[39mnode_modules/[4m@prisma[24m/client/src/runtime/getPrismaClient.ts:805:24[90m)[39m
    at async [90m/home/calm/nestJs/MediFlow/backend/[39mnode_modules/[4m@nestjs[24m/core/router/router-execution-context.js:46:28
    at async [90m/home/calm/nestJs/MediFlow/backend/[39mnode_modules/[4m@nestjs[24m/core/router/router-proxy.js:9:17 {
  code: [32m'P2003'[39m,
  meta: {
    modelName: [32m'Visit'[39m,
    driverAdapterError: DriverAdapterError: ForeignKeyConstraintViolation
        at PgTransaction.onError [90m(/home/calm/nestJs/MediFlow/backend/[39mnode_modules/[4m@prisma[24m/adapter-pg/dist/index.js:687:11[90m)[39m
        at PgTransaction.performIO [90m(/home/calm/nestJs/MediFlow/backend/[39mnode_modules/[4m@prisma[24m/adapter-pg/dist/index.js:682:12[90m)[39m
    [90m    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)[39m
        at async PgTransaction.queryRaw [90m(/home/calm/nestJs/MediFlow/backend/[39mnode_modules/[4m@prisma[24m/adapter-pg/dist/index.js:602:30[90m)[39m
        at e.interpretNode [90m(/home/calm/nestJs/MediFlow/backend/[39mnode_modules/[4m@prisma[24m/client-engine-runtime/src/interpreter/query-interpreter.ts:182:26[90m)[39m
        at e.interpretNode [90m(/home/calm/nestJs/MediFlow/backend/[39mnode_modules/[4m@prisma[24m/client-engine-runtime/src/interpreter/query-interpreter.ts:209:41[90m)[39m
        at e.interpretNode [90m(/home/calm/nestJs/MediFlow/backend/[39mnode_modules/[4m@prisma[24m/client-engine-runtime/src/interpreter/query-interpreter.ts:124:29[90m)[39m
        at e.interpretNode [90m(/home/calm/nestJs/MediFlow/backend/[39mnode_modules/[4m@prisma[24m/client-engine-runtime/src/interpreter/query-interpreter.ts:268:41[90m)[39m
        at e.interpretNode [90m(/home/calm/nestJs/MediFlow/backend/[39mnode_modules/[4m@prisma[24m/client-engine-runtime/src/interpreter/query-interpreter.ts:258:25[90m)[39m
        at e.run [90m(/home/calm/nestJs/MediFlow/backend/[39mnode_modules/[4m@prisma[24m/client-engine-runtime/src/interpreter/query-interpreter.ts:93:23[90m)[39m {
      cause: {
        originalCode: [32m'23503'[39m,
        originalMessage: [32m'insert or update on table "Visit" violates foreign key constraint "Visit_departmentId_fkey"'[39m,
        kind: [32m'ForeignKeyConstraintViolation'[39m,
        constraint: {
          index: [32m'Visit_departmentId_fkey'[39m
        }
      }
    }
  },
  clientVersion: [32m'7.3.0'[39m
}
Killed
